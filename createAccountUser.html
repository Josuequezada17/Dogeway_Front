<!DOCTYPE html>
<html lang="en">

<head>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>Crear cuenta usuario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link rel="stylesheet" href="css/createAccountUser.css" as="style" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

</head>

<body>

    <header class="masthead">

        <nav class=" navbar navbar-expand-lg navbar-light bg-light shadow fixed-top">

            <div class="container">

                <img class="logo" src="img/Logo.png" alt="">
                <a class="navbar-brand" href="homeDogeway_josue.html">DogeWay</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarResponsive">

                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="aboutUsNoLogeado.html">Mas Informacion</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="PrivacyPolicyNoLogeado.html">Seguridad</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="ayudaNoLogeado.html">Asistencia</a>
                        </li>
                    </ul>

                </div>
            </div>

        </nav>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
            </script>

    </header>

    <main>
        <form id="form-register" method="post" enctype="multipart/form-data">

            <div class="column">

                <fieldset>

                    <label for="nombre">Nombre completo</label>
                    <input type="text" name="nombreCompleto" id="nombres" class="StyleInp" required>

                    <label for="Apellido">Apellidos</label>
                    <input type="text" name="apellidos" id="apellidos" class="StyleInp" required>

                    <label for="correoElectronico">Correo Electrónico</label>
                    <input type="email" name="correo" id="correo" class="StyleInp" placeholder="email@domain.com"
                        required>

                   

                </fieldset>

                <fieldset class="FieldIB">
                    <legend>Intereses
                        <select name="interes" id="Intereses">
                            <option>PERROS</option>
                            <option>GATOS</option>
                            <option>CONEJOS</option>
                        </select required>
                    </legend>
                </fieldset>

                <fieldset class="FieldIB">
                    <legend>Genero
                        <select name="genero" id="Genero">
                            <option>HOMBRE</option>
                            <option>MUJER</option>
                            <option>OTRO</option>
                        </select required>
                    </legend>
                </fieldset>

                <label for="fechaNacimiento">Fecha de nacimiento</label>
                <input type="date" id="fechaNacimiento" class="StyleInp" name="fechaNacimiento" required>

                <fieldset>
                    <label for="pais">Pais</label>
                    <input type="text" id="pais" class="StyleInp" name="pais" required>

                    <label for="estado">Estado</label>
                    <input type="text" id="estado" class="StyleInp" name="estado" required>

                    <label for="colonia">Ciudad</label>
                    <input type="text" id="ciudad" class="StyleInp" name="ciud" required>
                </fieldset>

                <label for="telefono">Teléfono</label>
                <input type="text" name="telefono" id="telefono" class="StyleInp" placeholder="(XX) XXXX XXXX" required>

                <fieldset class="FieldIB">

                    <label for="password">Contraseña</label>
                    <input type="password" name="password" id="password" class="StyleInp" required>

                </fieldset>

                <fieldset class="FieldIB">

                    <label for="confirm_password">Confirmar contraseña</label>
                    <input type="password" name="confirm_password" id="confirm_password" class="StyleInp" required>

                </fieldset>

            </div>

            <div class="column" class="columnPhotos">
                <div method="post" enctype="multipart/form-data">
                    <div class="DivInpImg">
                        <input type="file" id="image1" class="InpImg" accept="image/*" name="imgU1">
                        <img class="mas" src="img/mas.png">
                    </div>

                    <div class="DivInpImg">
                        <input type="file" id="image2" class="InpImg" accept="image/*" name="imgU2">
                        <img class="mas" src="img/mas.png">
                    </div>

                    <div class="DivInpImg">
                        <input type="file" id="image3" class="InpImg" accept="image/*" name="imgU3">
                        <img class="mas" src="img/mas.png">
                    </div>

                    <div class="DivInpImg">
                        <input type="file" id="image4" class="InpImg" accept="image/*" name="imgU4">
                        <img class="mas" src="img/mas.png">
                    </div>


                    <div class="DivInpImg">
                        <input type="file" id="image5" class="InpImg" accept="image/*" name="imgU5">
                        <img class="mas" src="img/mas.png">
                    </div>

                    <div class="DivInpImg">
                        <input type="file" id="image6" class="InpImg" accept="image/*" name="imgU6">
                        <img class="mas" src="img/mas.png">
                    </div>

                </div>

            </div>



            <div class="Btn_XY">
                <button type="submit" onclick="verifier()" class="BtnGrl">Continuar</button>
            </div>

        </form>


        <section class="modalVerification">
            <div class="modalContenedorVerification">
    
                <div class="imagenVerification">
                    <img class="fotoCloseVerification" src="img/close.png">
                </div>
    
                <h2 class="modalTituloVerification">Verificación de de correo</h2>
    
                    <p>Se ha enviado un PIN a tu correo electrónico. Por favor, ingrésalo a continuación:</p>
                    <input type="text" id="pinInput" class="form-control" placeholder="Ingresa el PIN">
    
                        <div class="Btn_XY">
                            <button type="submit" id="verifyButton" >Continuar</button>
                        </div>
    
                </form>
            </div>
        </section>

       <script>

            function verifier() {
                document.getElementById('form-register').addEventListener('submit', function (event) {
                event.preventDefault(); 
                var correoValue = document.getElementById('correo').value;

                var nombreValue = document.getElementById('nombres').value;
                    var apellidoValue = document.getElementById('apellidos').value;
                    var InteresesValue = document.getElementById('Intereses').value;
                    var generoValue = document.getElementById('Genero').value;
                    var fechaNacimientoValue = document.getElementById('fechaNacimiento').value;
                    var paisValue = document.getElementById('pais').value;
                    var estadoValue = document.getElementById('estado').value;
                    var ciudadValue = document.getElementById('ciudad').value;
                    var telefonoValue = document.getElementById('telefono').value;
                    var passwordValue = document.getElementById('password').value;
                    var confirm_passwordValue = document.getElementById('confirm_password').value;

                    if (passwordValue !== confirm_passwordValue) {
                        alert("Contraseña incorrecta");
                        return;
                    } else {
                        // Continuar con el proceso
                    }
                    var imageInput = document.getElementById('image1');

                    var userData = {
                        nombres: nombreValue,
                        apellidos: apellidoValue,
                        correo: correoValue,
                        intereses: InteresesValue,
                        genero: generoValue,
                        fechaNacimiento: fechaNacimientoValue,
                        pais: paisValue,
                        estado: estadoValue,
                        ciudad: ciudadValue,
                        telefono: telefonoValue,
                        password: passwordValue,
                        foto:imageInput
                    };

                // Realizar la solicitud para obtener el código de verificación
                fetch('http://localhost:8080/signup/verifier?correo=' + correoValue, {
                    method: 'POST',
                })
                    .then(response => response.text())
                    .then(codigoVerificacion => {
                        // Mostrar el modal de verificación
                        
                        mostrarModalVerificacion(codigoVerificacion,userData,);
                       
                        
                    })
                    .catch(error => {
                        console.error('Error al obtener el código de verificación:', error);
                    });
                
                });
            }
                 
        </script>


        <script>
           function mostrarModalVerificacion(codigoVerificacion,userData) {
    // Mostrar el modal de verificación
    var pinInput = document.getElementById('pinInput');
    pinInput.value = ''; // Limpiar el campo del PIN

    // Obtener la referencia al modal
    var modalVerification = document.querySelector('.modalVerification');

    // Agregar la clase que muestra el modal
    modalVerification.classList.add('modalVerification--show');

    document.getElementById('verifyButton').addEventListener('click', function () {
        var pinIngresado = pinInput.value;
console.log(codigoVerificacion);
        // Realizar la solicitud para verificar el código de verificación
        if(pinIngresado==codigoVerificacion){
        register(userData);
}else{

alert("El codigo es incorrecto verificalo");
}

    });
}


        </script>

        <script>


            function register(userData) {
              
                    // Obtener los valores de los campos de entrada

                    // Crear objeto FormData para enviar archivos
                    var formData = new FormData();
                    formData.append('nombres', userData.nombres);
                    formData.append('apellidos', userData.apellidos);
                    formData.append('correo', userData.correo);
                    formData.append('intereses', userData.intereses);
                    formData.append('genero', userData.genero);
                    formData.append('fechaNacimiento', userData.fechaNacimiento);
                    formData.append('pais', userData.pais);
                    formData.append('estado', userData.estado);
                    formData.append('ciudad', userData.ciudad);
                    formData.append('telefono', userData.telefono);
                    formData.append('password', userData.password);

                    // Agregar la imagen al FormData
                    var imageInput=userData.foto;
                    if (imageInput.files.length > 0) {
                        formData.append('foto', imageInput.files[0]);
                    }

                    // Realizar la solicitud POST al servidor
                    fetch('http://localhost:8080/signup', {
                        method: 'POST',
                        body: formData
                    })
                        .then(response => response.json())
                        .then(message => {
                            console.log('Respuesta del servidor:', message);

                            sessionStorage.setItem('correo', correoValue);
                            alert("Creada Correctamente");

                        })
                        .catch(error => {
                            console.error('Error al enviar la solicitud:', error);
                            alert("Algo salio mal verificalo");
                        });
                
            }



        </script>

       

    </main>

   

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script src="JS/verifierBtn.js"></script>

    <footer>

    </footer>

</body>

</html>